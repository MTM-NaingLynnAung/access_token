<% if flash[:alert] %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
   <%= flash[:alert] %>
   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% end %>
<h3 class="text-center">External Service Parameters Update</h3>

<%= form_with url: params[:definition] == '2' ? "/linkage_systems/#{params[:id]}/google?definition=#{params[:definition]}" : "/linkage_systems/#{params[:id]}?definition=#{params[:definition]}", method: :put, local: true do |form| %>

  <div class="col-3 my-3">
    <%= form.label 'Label' %>
    <%= form.text_field :label, class: "form-control", value: @external_service.linkage_system.label %>
  </div>

  <% @external_service.external_service_parameters.each do |current_value| %>
    <% if current_value.external_service_parameter_definition.is_displayed != 0 %>

      <div class="col-3 my-3">
        <%= form.label "#{current_value.external_service_parameter_definition.name}" %>
        <%= form.text_field current_value.external_service_parameter_definition.id, class: "form-control", value: current_value.external_service_parameter_definition.is_encrypted == 0 ? current_value.parameter_value : crypt.decrypt_and_verify(current_value.parameter_value) %>
      </div>
    <% end %>
  <% end %>

<%= link_to 'Back', linkage_system_path(definition: params[:definition]), class: 'btn btn-dark me-2' %>
<%= form.submit 'Confirm', class: 'btn btn-primary' %>

<% end %>
